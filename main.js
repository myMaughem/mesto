(()=>{"use strict";var e=document.querySelector("#profile-form"),t=document.querySelector("#profile-photo"),n=document.querySelector("#profile-avatar-form"),r=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__avatar-button"),a=document.querySelector(".popup__input-text_profile_name"),u=document.querySelector(".popup__input-text_profile_info");function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}document.querySelector(".popup__input-text_avatar_url");var l=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.data.isCardLiked=this.isCardLiked(t.userId),this.data.isAvailableToRemove=t.userId===t.owner._id,this.cardSelector=n,this.handleCardClick=r.onCardClick,this.handleLikeClick=r.onLikeClick,this.handleTrashClick=r.onTrashClick}var t,n;return t=e,(n=[{key:"getTemplate",value:function(){return document.querySelector(this.cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this.element=this.getTemplate(),this.addEvents(),this.element.querySelector(".element__trash"),this.element.querySelector(".element__trash").classList.toggle("element__trash_hidden",!this.data.isAvailableToRemove),this.element.querySelector(".element__photo").src=this.data.link,this.element.querySelector(".element__photo").alt=this.data.name,this.element.querySelector(".element__photo-text").textContent=this.data.name,this.renderLikes(),this.element}},{key:"updateLikes",value:function(e,t){this.data.likes=t,this.data.isCardLiked=this.isCardLiked(e),this.renderLikes()}},{key:"renderLikes",value:function(){this.element.querySelector(".element__like-count").textContent=this.data.likes.length,this.element.querySelector(".element__like-button").classList.toggle("element__like-button_active",this.data.isCardLiked)}},{key:"addEvents",value:function(){var e=this,t=this.element.querySelector(".element__like-button"),n=this.element.querySelector(".element__trash"),r=this.element.querySelector(".element__photo");t.addEventListener("click",(function(t){return e.likeCard(t)})),n.addEventListener("click",(function(){return e.handleTrashClick(e.data._id)})),r.addEventListener("click",(function(){e.handleCardClick(e.data.name,e.data.link)}))}},{key:"likeCard",value:function(){this.handleLikeClick(this.data._id)}},{key:"deleteCard",value:function(){this.element.remove()}},{key:"isCardLiked",value:function(e){return this.data.likes.some((function(t){return t._id===e}))}}])&&c(t.prototype,n),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t,n){var r,o=t.inputSelector,i=t.submitButtonSelector,a=t.inputErrorClass,u=t.inputErrorTextClass;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(r="_hasListeners")in this?Object.defineProperty(this,r,{value:false,enumerable:!0,configurable:!0,writable:!0}):this[r]=false,this.formElement=n,this.inputSelector=o,this.submitButtonSelector=i,this.inputErrorClass=a,this.inputErrorTextClass=u;var c=Array.from(this.formElement.querySelectorAll(this.inputSelector)),l=this.formElement.querySelector(this.submitButtonSelector);this.inputList=c,this.buttonElement=l}var t,n;return t=e,(n=[{key:"enableValidation",value:function(){this._setEventListener()}},{key:"_setEventListener",value:function(){var e=this;this._hasListeners||(this.formElement.addEventListener("reset",(function(){e.hideInputErrors()})),this.inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))})),this.formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._hasListeners=!0)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}},{key:"_hideInputError",value:function(e){var t=this.formElement.querySelector(".".concat(e.id,"-error"));t.classList.remove(this.inputErrorTextClass),t.textContent="",e.classList.remove(this.inputErrorClass)}},{key:"_showInputError",value:function(e){var t=this.formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this.inputErrorClass),t.classList.add(this.inputErrorTextClass),t.textContent=e.validationMessage}},{key:"_toggleButtonState",value:function(){this.buttonElement.disabled=this._hasInvalidInput()}},{key:"_hasInvalidInput",value:function(){return this.inputList.some((function(e){return!e.validity.valid}))}},{key:"hideInputErrors",value:function(){var e=this;this.inputList.forEach((function(t){e._hideInputError(t)}))}}])&&s(t.prototype,n),e}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=r,this.itemRenderer=o,this.container=document.querySelector(n)}var t,n;return t=e,n=[{key:"renderer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"after";return this.container.innerHTML="",this.items.forEach((function(n){var r=e.itemRenderer(n);e.addItem(r,t)})),this}},{key:"addItem",value:function(e,t){return"after"===t?this.container.append(e):this.container.prepend(e),this}},{key:"setItems",value:function(e){return this.items=e,this}}],n&&p(t.prototype,n),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(t){var n,r,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){"Escape"===e.key&&o.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this.popup=document.querySelector(t)}var t,n;return t=e,(n=[{key:"open",value:function(){this.popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this.popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this.popup.querySelector(".popup__close-icon").addEventListener("click",(function(){e.close()})),this.popup.addEventListener("mousedown",(function(t){t.target===t.currentTarget&&e.close()}))}}])&&d(t.prototype,n),e}();function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},b(e,t,n||e)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function k(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(o){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return k(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).imagePhoto=t.popup.querySelector(".popup__photo-watch"),t.imageText=t.popup.querySelector(".popup__photo-watch-text"),t.setEventListeners(),t}return t=a,(n=[{key:"open",value:function(e,t){b(g(a.prototype),"open",this).call(this),this.imagePhoto.src=t,this.imagePhoto.alt=e,this.imageText.textContent=e}}])&&m(t.prototype,n),a}(y);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},O(e,t,n||e)}function C(e,t){return C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},C(e,t)}function L(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=j(r);if(o){var n=j(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e)).confirmBtn=n.popup.querySelector("button[data-confirm=true]"),n.refuseBtn=n.popup.querySelector("button[data-confirm=false]"),n.confirmHandler=t.onConfirm,n.setEventListeners(),n}return t=a,(n=[{key:"open",value:function(e){this.confirmationData=e,O(j(a.prototype),"open",this).call(this)}},{key:"setEventListeners",value:function(){var e=this;this.confirmHandler&&this.confirmBtn&&this.confirmBtn.addEventListener("click",(function(){O(j(a.prototype),"close",e).call(e),e.confirmHandler(e.confirmationData)})),O(j(a.prototype),"setEventListeners",this).call(this)}}])&&S(t.prototype,n),a}(y);function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="data")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this.data=r,this.nameElement=document.querySelector(t.name),this.aboutElement=document.querySelector(t.about),this.avatarElement=document.querySelector(t.avatar)}var t,n;return t=e,(n=[{key:"getUserId",value:function(){return this.data._id}},{key:"getUserInfo",value:function(){return this.data}},{key:"setUserInfo",value:function(e){Object.assign(this.data,e),this.updateElements()}},{key:"updateElements",value:function(e,t){this.avatarElement.src=this.data.avatar,this.nameElement.textContent=this.data.name,this.aboutElement.textContent=this.data.about}}])&&q(t.prototype,n),e}();function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},B(e,t,n||e)}function D(e,t){return D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},D(e,t)}function A(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return A(this,e)});function a(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return x(this,a),(n=i.call(this,e))._handleFormSubmit=t,n.form=n.popup.querySelector("form"),n.isAsync=r,n.setEventListeners(),n}return t=a,(n=[{key:"open",value:function(){B(U(a.prototype),"open",this).call(this),this.popup.querySelector(".popup__save-button").disabled=!0}},{key:"close",value:function(){B(U(a.prototype),"close",this).call(this),this.form.reset()}},{key:"_getInputValues",value:function(){var e=this.popup.querySelectorAll(".popup__input-text"),t={};return e.forEach((function(e){return t[e.name]=e.value})),t}},{key:"setEventListeners",value:function(){var e=this;this.form.addEventListener("submit",(function(t){t.preventDefault();var n=e.isAsync?e.pending():void 0;e._handleFormSubmit(e._getInputValues(),n),n||e.close()})),B(U(a.prototype),"setEventListeners",this).call(this)}},{key:"pending",value:function(){var e=this.popup.querySelector("button[type=submit]"),t=e.textContent;return e.textContent="Сохранение...",function(){e.textContent=t}}}])&&R(t.prototype,n),a}(y);function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var M=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t.url,this.headers=t.headers}var t,n;return t=e,(n=[{key:"_request",value:function(e,t,n){return fetch(this.url+t,{method:e,headers:this.headers,body:n?JSON.stringify(n):void 0}).then(N)}},{key:"getProfileInfo",value:function(){return this._request("GET","/users/me")}},{key:"getCards",value:function(){return this._request("GET","/cards")}},{key:"profileUpdate",value:function(e,t){return this._request("PATCH","/users/me",{name:e,about:t})}},{key:"addNewCard",value:function(e,t){return this._request("POST","/cards",{name:e,link:t})}},{key:"avatarUpdate",value:function(e){return this._request("PATCH","/users/me/avatar",{avatar:e})}},{key:"deleteCard",value:function(e){return fetch("".concat(this.url,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then(N)}},{key:"toggleLike",value:function(e,t){var n=t?"PUT":"DELETE";return this._request(n,"/cards/likes/".concat(e))}}])&&H(t.prototype,n),e}();function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){J(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $={inputSelector:".popup__input-text",submitButtonSelector:".popup__save-button",inputErrorClass:"popup__input-text_type_error",inputErrorTextClass:"popup__input-error_active"},K=new f($,e),Q=new f($,t),W=new f($,n);K.enableValidation(),Q.enableValidation(),W.enableValidation();var X=new E("#popup__photo-open"),Y=new P("#popup__photo-delete",{onConfirm:function(e){var t=e.id;ue.deleteCard(t).then((function(){Z[t].deleteCard()})).catch(se)}}),Z={},ee=function(e,t){X.open(e,t)},te=function(e){var t=Z[e],n=ae.getUserId(),r=t.isCardLiked(n);ue.toggleLike(e,!r).then((function(e){t.updateLikes(n,e.likes)})).catch(se)},ne=function(e){Y.open({id:e})},re=function(e){var t=z(z({},e),{},{userId:ae.getUserId()}),n=new l(t,"#element_template",{onCardClick:ee,onLikeClick:te,onTrashClick:ne});return Z[e._id]=n,n.generateCard()},oe=new h({items:[],renderer:re},".elements");oe.renderer();var ie=new V("#popup__profile-edt-avatar",(function(e,t){ue.avatarUpdate(e["avatar-photo-url"]).then((function(e){ae.setUserInfo(e),ie.close()})).catch(se).finally(t)}),!0);i.addEventListener("click",(function(){ie.open()}));var ae=new T({name:".profile__title",about:".profile__subtitle",avatar:".profile__avatar"}),ue=new M({url:"https://mesto.nomoreparties.co/v1/cohort-29",headers:{authorization:"2399b66a-f3da-4425-8ef3-39005dfdd9c5","Content-Type":"application/json"}});Promise.all([ue.getProfileInfo(),ue.getCards()]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];ae.setUserInfo(o),oe.setItems(i).renderer()})).catch(se);var ce=new V("#popup__profile-edt",(function(e,t){var n=e.fullname,r=e.info;ue.profileUpdate(n,r).then((function(e){ae.setUserInfo(e),ce.close()})).catch(se).finally(t)}),!0);r.addEventListener("click",(function(){ce.open()})),r.addEventListener("click",(function(){var e=ae.getUserInfo(),t=e.name,n=e.about;a.value=t,u.value=n}));var le=new V("#popup__photo-edt",(function(e,t){ue.addNewCard(e["photo-name"],e["photo-url"]).then((function(e){var t=re(e);oe.addItem(t,"before"),le.close()})).catch(se).finally(t)}),!0);function se(e){console.error(e)}o.addEventListener("click",(function(){le.open()}))})();